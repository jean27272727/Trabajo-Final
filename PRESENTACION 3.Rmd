---
title: "Precentacion3"
output: html_document
date: '2022-06-12'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rio)
TRABAJO1 =import("https://github.com/jean27272727/Trabajo-estadistico/blob/main/TRABAJO1.xlsx?raw=true")

#dato: el funcionamiento del gobierno como varaible dependiente. 
```
```{r}
export(TRABAJO1, "TRABAJO1.csv")
TRABAJO1= import("TRABAJO1.csv", encoding = "UTF-8")
head(TRABAJO1)
TRABAJO1$pais= substr(TRABAJO1$pais, 3, 100)
```

#RELACION 1: ENTRE 2 INDEPENDIENTES Y UNA DEPENDIENTE

# Relacion entre funcionamiento_del_gobierno, participacion politica y libertades civiles  : modelo 4
```{r}
modelo4= lm(TRABAJO1$funcionamiento_del_gobierno~TRABAJO1$participacion_politica+TRABAJO1$libertades_civiles)
summary(modelo4)
# Regla de control, mientras agregue más variables siempre tiene que aumentar. La varaible participacion politica no aporta al modelo porque mi r2 ajustado disminuye.

```
# Relacion entre funcionamiento_del_gobierno, participacion politica, libertades civiles y cultura politica : modelo 5

```{r}
modelo5 = lm(TRABAJO1$funcionamiento_del_gobierno~TRABAJO1$participacion_politica+TRABAJO1$libertades_civiles+TRABAJO1$cultura_politica)
summary(modelo5)
# la variable: participacion politica peude ser una variable espuria (no tiene nada que ver) o tal vez dicha variable esta incluida en las otras dos. 
```
# Explicacion del porqué de la caida del modelo donde estan incluidas la participacion politica y las libertades civiles
```{r}

plot(TRABAJO1$participacion_politica,TRABAJO1$libertades_civiles) 
```
```{r}
cor.test(TRABAJO1$participacion_politica,TRABAJO1$libertades_civiles)

#conclución: Existe una correlacion muy fuerte entre las varaibles participacion politica y libertades civiles. La correalcion es 0.7924591. En este sentido, si se mantiene como constante (todos los paises tienen el mismo nivel) la participacion política deja de tener un efecto. Esto se explica posiblemente porque la participacion politica depende mucho de las libertades civiles del pais. Ademas, las unidades de analisis de las variables son diferentes (the economics, 2020). 
```
#Relacion donde estan incluidas libertades civiles y participacion politica

```{r}
library(stargazer)
stargazer(modelo4,modelo5,type = "text",no.space = F,digits =3,digit.separator="")
```
## Relacion entre funcionamiento_del_gobierno, libertades civiles y cultura politica : modelo 6
```{r}
modelo6= lm(TRABAJO1$funcionamiento_del_gobierno~+TRABAJO1$libertades_civiles+TRABAJO1$cultura_politica)
summary(modelo6)
# segun el p valor de cada una de mis variables aportan a mi modelo.Ademas, el  p-value general < 2.2e-16, es menor a 0,05. En este sentido, se rechaza la hipotesis nula y se concluye que el modelo sí es valido. 
# el Rcuadrado explica un 72,9%
```

#RELACION  2: 3 INDEPENDIENTES Y UNA DEPENDIENTE
# Relacion entre funcionamiento_del_gobierno, participacion politica y cultura politica : modelo 7
```{r}
modelo7= lm(TRABAJO1$funcionamiento_del_gobierno~+TRABAJO1$participacion_politica+TRABAJO1$cultura_politica)
summary(modelo7)
# segun mi p valor de cada una de mis variables aportan a mi modelo.ademas, el  p-value general < 2.2e-16, es menor a 0,05. Entonces, se rechaza la hipotesis nula y se concluye que el modelo sí es valido. 
# el Rcuadrado explica un 58,64%
```

#Nivel explicativo de ambos modelos
```{r}
anova(modelo7)
```

```{r}
anova(modelo6)
```
```{r}
modelo6$coefficients
#la formula sería:   Funcionamiento del gobierno=  -0.4333345 + 0.6941675(libertades civiles)+ 0.2485963(cultura politica)

# A partir del analisis entre el modelo 6 y 7 se concluye que el modelo 6 es más explicativo (explica mejor el funcionamiento del gobierno) que el modelo 7, en base a su r2, y presenta menor error estandar residual. En este sentido, se trabajará con el modelo 6. Es por ello que se procede a diagnosticar la regresion de dicho modelo para demostrar que es adecuado. Ver anexo 1.
```





#Análisis de conglomerado
```{r}
dataclous= TRABAJO1 [,-1]
row.names(dataclous)=TRABAJO1$pais
```
```{r}
library(cluster)
g.dist = daisy(dataclous, metric="gower")
```
```{r}
#PARA PAM: 
library(factoextra)
fviz_nbclust(dataclous, pam,diss=g.dist,method = "gap_stat",k.max = 10,verbose = F)
```

```{r}
# PARA Agnes

fviz_nbclust(dataclous, hcut,diss=g.dist,method = "gap_stat",k.max = 10,verbose = F,hc_func = "agnes")
```

```{r}
## PARA DIANA

fviz_nbclust(dataclous, hcut,diss=g.dist,method = "gap_stat",k.max = 10,verbose = F,hc_func = "diana")
```
```{r}
###pam
set.seed(123)
grupos=4 ##experimentar 5-6
res.pam=pam(g.dist,k = grupos,cluster.only = F)
dataclous$pam=res.pam$cluster

###agnes
res.agnes<- hcut(g.dist, k =grupos,hc_func='agnes',hc_method = "ward.D")
dataclous$agnes=res.agnes$cluster

### diana
res.diana <- hcut(g.dist, k = grupos,hc_func='diana')
dataclous$diana=res.diana$cluster
```

```{r}
#Se utiliza AGNES, fijarse en el anexo 2
fviz_silhouette(res.agnes)

```

```{r}
# Encontremos los casos MAL clusterizados (silueta negativa):

library(magrittr)

silPAM=data.frame(res.pam$silinfo$widths)
silPAM$country=row.names(silPAM)
poorPAM=silPAM[silPAM$sil_width<0,'country']%>%sort()

silAGNES=data.frame(res.agnes$silinfo$widths)
silAGNES$country=row.names(silAGNES)
poorAGNES=silAGNES[silAGNES$sil_width<0,'country']%>%sort()

silDIANA=data.frame(res.diana$silinfo$widths)
silDIANA$country=row.names(silDIANA)
poorDIANA=silDIANA[silDIANA$sil_width<0,'country']%>%sort()

###
library("qpcR") 
mal_Clus=as.data.frame(qpcR:::cbind.na(poorPAM, poorAGNES,poorDIANA))
mal_Clus
```

```{r}
#Podemos usar teoría de conjuntos para ver qué los casos mal clusterizados en todos las técnicas:
intersect(poorPAM,poorAGNES)

setdiff(poorAGNES,poorPAM)



```

#GRAFICO SEGUN AGNES
```{r}
original=aggregate(.~ pam, data=dataclous,mean)
original

```
```{r}

dataclous$agnes=dplyr::recode(dataclous$pam, `3` = 1, `4`=2,`2`=3,`1`=4)
```
```{r}
#proyectando los casos en dos dimensiones:

proyeccion = cmdscale(g.dist, k=2,add = T) # k es la cantidad de dimensiones
dataclous$dim1 <- proyeccion$points[,1]
dataclous$dim2 <- proyeccion$points[,2]
base= ggplot(dataclous,aes(x=dim1, y=dim2,label=row.names(dataclous))) 
base + geom_text(size=2, aes(color=as.factor(diana)))  + labs(title = "AGNES") 
```





#Anexo 1

#diagnostico de la regresion del modelo 6


```{r}
#Linealidad

plot(modelo6, 1)
#la linea tienden a la horizontalidad por lo cual es aceptable. 
```

```{r}
#Homoceasticidad

plot(modelo6, 3)
# como la linea roja tiende a la horizontalidad el modelo es aceptable. 
```


```{r}
#Normalidad de residuos 
plot(modelo6, 2)
# los puntos estan cerca a la diagonal, por tanto la diferencia entre apropiaciondolar y apropiaciondolar se destribuye de manera normal
```
```{r}
shapiro.test(modelo6$residuals)
```


```{r}
# multicolinealidad
library(DescTools)
VIF(modelo6) #como los valores son menores a 5 se concluye que no presenta multicolinealidad.
```

```{r}
#valores influyentes
plot(modelo6, 5)
```
```{r}
#casos influyentes
checkmodelo6=as.data.frame(influence.measures(modelo6)$is.inf)
head(checkmodelo6)
```

```{r}
checkmodelo6[checkmodelo6$cook.d & checkmodelo6$hat,]
# se concluye que no presenta valores influyentes. 
```

#ANEXO 2
```{r}
# CONCLUCION ANEXO 2: el metodo AGNES es mejor porque presenta un mejor resultado: su promedio es 0,32; por ende presenta una mejor conglomeracion. 

fviz_silhouette(res.pam)
```
```{r}
fviz_silhouette(res.agnes)
```
```{r}
fviz_silhouette(res.diana)
```

